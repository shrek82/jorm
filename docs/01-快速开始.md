# 快速开始

本指南将带你快速上手 jorm，通过一个完整的示例展示 jorm 的核心功能。

## 环境要求

- Go 1.25.3 或更高版本
- 支持的数据库驱动：
  - MySQL: `github.com/go-sql-driver/mysql`
  - PostgreSQL: `github.com/lib/pq`
  - SQLite: `github.com/mattn/go-sqlite3`

## 安装

```bash
go get github.com/shrek82/jorm
```

## 完整示例

以下是一个完整的示例，演示了从连接数据库到执行 CRUD 操作的全过程：

```go
package main

import (
    "fmt"
    "time"

    "github.com/shrek82/jorm/core"
    _ "github.com/mattn/go-sqlite3"
)

// 定义用户模型
type User struct {
    ID        int64     `jorm:"pk auto"`
    Name      string    `jorm:"size:100 notnull"`
    Email     string    `jorm:"size:100 unique"`
    Age       int       `jorm:"default:0"`
    Status    string    `jorm:"default:'active'"`
    CreatedAt time.Time `jorm:"auto_time"`
    UpdatedAt time.Time `jorm:"auto_update"`
}

func main() {
    // 1. 连接数据库
    db, err := core.Open("sqlite3", "./test.db", &core.Options{
        MaxOpenConns:    10,
        MaxIdleConns:    5,
        ConnMaxLifetime: time.Hour,
    })
    if err != nil {
        panic(err)
    }
    defer db.Close()

    // 2. 自动创建表
    err = db.AutoMigrate(&User{})
    if err != nil {
        panic(err)
    }

    // 3. 插入数据
    user := &User{
        Name:  "Alice",
        Email: "alice@example.com",
        Age:   25,
    }
    id, err := db.Model(user).Insert(user)
    if err != nil {
        panic(err)
    }
    fmt.Printf("插入成功，ID: %d\n", id)

    // 4. 查询数据
    var u User
    err = db.Model(&User{}).Where("id = ?", id).First(&u)
    if err != nil {
        panic(err)
    }
    fmt.Printf("查询结果: %+v\n", u)

    // 5. 更新数据
    affected, err := db.Model(&User{}).
        Where("id = ?", id).
        Update(map[string]any{
            "age": 26,
        })
    if err != nil {
        panic(err)
    }
    fmt.Printf("更新成功，影响行数: %d\n", affected)

    // 6. 删除数据
    affected, err = db.Model(&User{}).Where("id = ?", id).Delete()
    if err != nil {
        panic(err)
    }
    fmt.Printf("删除成功，影响行数: %d\n", affected)
}
```

## 核心概念

### 1. 模型（Model）

模型是 Go 结构体，使用 `jorm` 标签定义数据库映射关系：

```go
type User struct {
    ID        int64     `jorm:"pk auto"`         // 主键，自增
    Name      string    `jorm:"size:100 notnull"` // 长度100，非空
    Email     string    `jorm:"size:100 unique"`  // 长度100，唯一
    Age       int       `jorm:"default:0"`        // 默认值0
    CreatedAt time.Time `jorm:"auto_time"`       // 插入时自动设置
    UpdatedAt time.Time `jorm:"auto_update"`     // 更新时自动设置
}
```

### 2. 数据库连接

使用 `core.Open` 创建数据库连接：

```go
db, err := core.Open(
    "sqlite3",           // 驱动名称
    "./test.db",         // DSN（数据源名称）
    &core.Options{       // 连接选项
        MaxOpenConns:    10,
        MaxIdleConns:    5,
        ConnMaxLifetime: time.Hour,
    },
)
```

### 3. 查询构建器

使用 `db.Model` 创建查询构建器，支持链式调用：

```go
db.Model(&User{}).Where("age > ?", 18).Find(&users)
```

### 4. CRUD 操作

jorm 提供了完整的 CRUD 操作接口：

```go
// Create - 插入
id, err := db.Model(user).Insert(user)

// Read - 查询
err := db.Model(&User{}).Where("id = ?", id).First(&user)

// Update - 更新
affected, err := db.Model(&User{}).Where("id = ?", id).Update(map[string]any{"age": 26})

// Delete - 删除
affected, err := db.Model(&User{}).Where("id = ?", id).Delete()
```

## 支持的数据库

### MySQL

```go
db, err := core.Open("mysql", "user:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4", opts)
```

### PostgreSQL

```go
db, err := core.Open("postgres", "host=localhost port=5432 user=postgres dbname=app sslmode=disable", opts)
```

### SQLite

```go
db, err := core.Open("sqlite3", "./app.db", opts)
```

## 下一步

- [数据库连接](./02-数据库连接.md) - 详细了解数据库连接和配置
- [模型定义](./03-模型定义.md) - 学习如何定义和配置模型
- [查询操作](./04-查询操作.md) - 掌握各种查询技巧
- [数据验证](./11-数据验证.md) - 了解数据验证功能

## 常见问题

### Q: 如何切换数据库？

A: 只需修改 `core.Open` 的第一个参数（驱动名称）和 DSN（数据源名称）：

```go
// MySQL
core.Open("mysql", "user:password@/dbname", opts)

// PostgreSQL
core.Open("postgres", "user=postgres dbname=app", opts)

// SQLite
core.Open("sqlite3", "./app.db", opts)
```

### Q: 如何调试 SQL？

A: 配置日志级别为 Info 即可看到执行的 SQL：

```go
import "github.com/shrek82/jorm/logger"

log := logger.NewStdLogger()
log.SetLevel(logger.Info)
db.SetLogger(log)
```

详见 [日志配置](./13-日志配置.md)

### Q: 表名和字段名如何映射？

A: jorm 自动将 PascalCase 转换为 snake_case：

- `User` → `user`
- `UserProfile` → `user_profile`
- `UserID` → `user_id`
- `CreatedAt` → `created_at`

也可以使用标签自定义：

```go
type User struct {
    ID   int64 `jorm:"column:custom_id"`
    Name string `jorm:"column:user_name"`
}

// 自定义表名
func (u *User) TableName() string {
    return "my_custom_users"
}
```
